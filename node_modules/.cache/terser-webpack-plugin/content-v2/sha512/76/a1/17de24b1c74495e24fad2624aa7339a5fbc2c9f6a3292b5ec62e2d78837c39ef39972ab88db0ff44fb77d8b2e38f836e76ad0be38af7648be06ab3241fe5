{"code":"!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){\"use strict\";var i;n.r(t),function(e){e[e.INPUT=1]=\"INPUT\",e[e.MATCH=2]=\"MATCH\",e[e.DROP=3]=\"DROP\",e[e.DROPPING=4]=\"DROPPING\",e[e.SHUFFLE=5]=\"SHUFFLE\",e[e.SWAPPING=6]=\"SWAPPING\",e[e.PAUSED=7]=\"PAUSED\",e[e.MATCHING=8]=\"MATCHING\"}(i||(i={}));const o=[\"red\",\"green\",\"yellow\",\"blue\"],r=(()=>{let e=i.PAUSED;return{get CURRENT(){return e},set CURRENT(t){console.debug(\"OLD STATE: %s \\nNEW STATE: %s\",e,t),e=t}}})(),l=document.getElementById(\"game\"),s=document.querySelector(\"#tile\"),d=document.querySelector(\"#node\"),c=e=>(f(e,!0),u(e,!0),a(e,void 0,.25),e.element.dataset.tileExplode=\"true\",new Promise(t=>{setTimeout(()=>{u(e,!1),m(e),e.element.dataset.tileExplode=\"false\",p(e,\"empty\"),t()},250)})),a=(e,t,n)=>{const i=n||(Math.abs(e.row-(t||0))+1)/8*.75;return Object.assign(e,{animationDuration:i})},u=(e,t)=>(e.element.style.transitionDuration=t?`${e.animationDuration}s`:\"0s\",Object.assign(e,{animate:t})),p=(e,t)=>(e.element.dataset.tileType=t,Object.assign(e,{type:t})),f=(e,t)=>Object.assign(e,{killed:t}),m=(e,t)=>(e.element.dataset.tileSpecial=t,Object.assign(e,{special:t})),x=(e,t,n)=>(t=null!=t?t:e.row,n=null!=n?n:e.column,e.element.style.setProperty(\"--y\",`${50*t+(4+4*t*2)}px`),e.element.style.setProperty(\"--x\",`${50*n+(4+4*n*2)}px`),Object.assign(e,{row:t,column:n})),h=(e,t,n)=>(u(e,!1),x(e,t,void 0),a(e,n,void 0),setTimeout(()=>{u(e,!0),x(e,n,void 0)},0),new Promise(t=>setTimeout(()=>{u(e,!1),t()},1e3*e.animationDuration))),E=()=>o[4*Math.random()|0],g=(e,t)=>t.reduce((t,n)=>t||n.find(t=>t.index===e),void 0),w=e=>e.index/8|0,N=e=>e.index%8,y=(e,t)=>e.forEach((e,n)=>e.forEach((e,i)=>t(e,n,i))),T=e=>!!e,S=(e,t)=>{let n=g(e.index-8,t)||void 0;return n&&n.tile.killed?S(n,t):n||void 0},P=(e,t,n)=>{const i=((e,t,n=\"empty\")=>{if(!s)throw new Error(\"No tiletemplate found!\");const i=s.content.cloneNode(!0).querySelector(\".tile\");if(!i)throw new Error('Cannot find \".tile\" in tiletemplate');i.dataset.tileType=n,i.innerHTML=`(${t}, ${e})`,i.style.setProperty(\"--y\",`${50*e+(4+4*e*2)}px`),i.style.setProperty(\"--x\",`${50*t+(4+4*t*2)}px`);return{element:i,animationDuration:.75*(e+1/8),animate:!1,type:n,row:e,column:t,special:void 0,killed:!1}})(e,t,E());if(!d)throw new Error(\"No nodetemplate found\");const o=d.content.cloneNode(!0).querySelector(\".node\");if(!o)throw new Error('Cannot find \".node\" in nodetemplate');return o.dataset.nodeIndex=n.toString(),o.innerHTML=n.toString(),{element:o,index:n,tile:i,selected:!1}},b=(e,t)=>{const n=Object.assign({},e.tile);Object.assign(e.tile,t.tile),Object.assign(t.tile,n)},R=e=>{if(e)return Object.assign(e,{selected:!e.selected}),e.element.dataset.nodeSelected=e.selected?\"true\":\"false\",e.selected&&console.debug(`NODE SELECTED: ${JSON.stringify(e)}`),e},v=e=>(t,n)=>!(!t||!n)&&n.tile.type===e.tile.type,C=(e,t)=>{const n=[];if(e.tile.column+2<8){const i=[e,g(e.index+1,t),g(e.index+2,t)].filter(T);let o=void 0;if(3===i.length&&i.reduce(v(e),!0)){const r=g(e.index+3,t),l=g(e.index+4,t);r&&r.tile.row===e.tile.row&&[...i,r].reduce(v(e),!0)&&(i.push(r),o=\"striped\",l&&l.tile.row===e.tile.row&&[...i,l].reduce(v(e),!0)&&(i.push(l),o=\"super\")),n.push({nodes:i,special:o})}}if(e.tile.row+2<8){const i=[e,g(e.index+8,t),g(e.index+16,t)].filter(T);let o=void 0;if(3===i.length&&i.reduce(v(e),!0)){const r=g(e.index+24,t),l=g(e.index+32,t);r&&r.tile.column===e.tile.column&&[...i,r].reduce(v(e),!0)&&(i.push(r),o=\"striped\",l&&l.tile.column===e.tile.column&&[...i,l].reduce(v(e),!0)&&(i.push(l),o=\"super\")),n.push({nodes:i,special:o})}}return n},O=(e,t)=>{return[e,g(e.index+1,t),g(e.index+2,t),g(e.index-1,t),g(e.index-2,t),g(e.index-8,t),g(e.index-16,t),g(e.index+8,t),g(e.index+16,t)].filter(T)},U=(e,t)=>0===e.tile.column&&7!==t.tile.column||7===e.tile.column&&0!==t.tile.column,A=(e,t)=>{if(!e||!t)return!1;const n=Math.abs(e.index-t.index),i=0===e.tile.column||7===e.tile.column,o=0===t.tile.column||7===t.tile.column,r=U(e,t),l=U(t,e);return!(1!==n&&8!==n||(i||o)&&!r&&!l)},I=(e,t)=>{const n=[],i=((e,t)=>{const n=[],i=g(e,t);if(!i)return n;const o=0===i.index?0:8*w(i),r=o+8-1;console.debug({node:i.index,rowStartIndex:o,rowEndIndex:r});for(let e=o;e<=r;e++){const i=g(e,t);i&&n.push(i)}return n})(e.index,t);return console.debug({explodingRow:i}),i.forEach(e=>{e.tile.killed||n.push(c(e.tile))}),n},D=(e,t)=>{const n=[],i=((e,t)=>{const n=[],i=g(e,t);if(!i)return n;const o=N(i),r=o+56;console.debug({node:e,columnStartIndex:o,columnEndIndex:r});for(let e=o;e<=r;e+=8){const i=g(e,t);i&&n.push(i)}return n})(e.index,t);return console.debug({explodingColumn:i}),i.forEach(e=>{e.tile.killed||n.push(c(e.tile))}),n},M=(e,t,n)=>!(!t||!A(e,t))&&(console.debug(`SWAP VALID: ${JSON.stringify(e)} <=> ${JSON.stringify(t)}`),b(t,e),!!((e,t,n)=>{return[...O(t,n),...O(e,n)].reduce((e,t)=>[...e,...C(t,n)],[]).length>0})(e,t,n)||(b(t,e),!1)),j=e=>t=>{if(t.target&&t.target.classList.contains(\"node\")){const n=t.target.dataset.nodeIndex;if(n){const t=g(parseInt(n),e);if(t){const n=(e=>e.reduce((e,t)=>e||t.find(e=>e.selected),void 0))(e);if(M(t,n,e)&&n){const e=w(n),o=w(t),l=N(n),s=N(t);return r.CURRENT=i.SWAPPING,((e,t)=>{const n=Object.assign({},e);return a(t,void 0,.5),u(t,!0),a(e,void 0,.5),u(e,!0),x(e,t.row,t.column),x(t,n.row,n.column),new Promise(e=>{setTimeout(()=>{e()},500)})})(n.tile,t.tile).then(()=>{r.CURRENT=i.MATCH}),R(n),{didSwap:!0,horizontalSwap:l!==s,verticalSwap:e!==o,selectedNode:t,prevSelectedNode:n}}n&&R(n),R(t)}}}return{didSwap:!1}};console.debug=(()=>{let e=0;return function(){console.log(`-----------${e}----------`),console.log(...arguments),console.log(`-----------${e}----------`),e++}})(),(()=>{const e=(()=>Array(8).fill(0).map((e,t)=>Array(8).fill(0).map((e,n)=>P(t,n,8*t+n))))();let t={didSwap:!1};const n=()=>{switch(r.CURRENT){case i.DROP:r.CURRENT=i.DROPPING,(e=>{const t=[...e.map(e=>[...e])];t.reverse();const n=[],i=[],o=[];for(;;){let i=0;if(y(t,t=>{if(t.tile.killed){const r=S(t,e);if(f(t.tile,!1),r){const e=t.tile.row,i=r.tile.type,o=r.tile.special;f(r.tile,!0),p(r.tile,t.tile.type),m(r.tile,t.tile.special),p(t.tile,i),m(t.tile,o),n.push(h(t.tile,r.tile.row,e))}else o.push(t);i++}}),0===i)break}return o.forEach(e=>{p(e.tile,E()),i.push(h(e.tile,e.tile.row-7,e.tile.row))}),Promise.all(n).then(()=>Promise.all(i))})(e).then(()=>r.CURRENT=i.MATCH);break;case i.MATCH:r.CURRENT=i.MATCHING,((e,t)=>{const n=new Set,i=[],o=[t.prevSelectedNode&&t.prevSelectedNode.index||-1,t.selectedNode&&t.selectedNode.index||-1];y(e,r=>{C(r,e).forEach(l=>{let s=!1;l.nodes.forEach((d,a)=>{if(!d.tile.killed)if(n.add(d),l.special&&!s)o.some(e=>r.index===e)?d.index===r.index&&(\"striped\"===l.special?m(d.tile,t.horizontalSwap?\"striped-horizontal\":\"striped-vertical\"):m(d.tile,l.special)):0===a&&(\"striped\"===l.special?m(d.tile,Math.random()>.5?\"striped-horizontal\":\"striped-vertical\"):m(d.tile,l.special)),s=!0;else if(i.push(c(d.tile)),d.tile.special)switch(d.tile.special){case\"striped-horizontal\":I(d,e).forEach(e=>i.push(e));break;case\"striped-vertical\":D(d,e).forEach(e=>i.push(e))}})})});const r=n.size>0;return Promise.all(i).then(()=>r)})(e,t).then(t=>{t?r.CURRENT=i.DROP:(e=>{let t=!0;return y(e,n=>{t&&(t=![g(n.index+1,e),g(n.index+8,e)].map(e=>e&&A(n,e)).some(e=>!!e))}),t})(e)?r.CURRENT=i.SHUFFLE:r.CURRENT=i.INPUT});break;case i.INPUT:}r.CURRENT!==i.PAUSED&&window.requestAnimationFrame(n)};if(!l)throw new Error(\"No gameElement found!\");y(e,e=>{l.appendChild(e.element),l.appendChild(e.tile.element)});const o=j(e);return l.addEventListener(\"click\",e=>{r.CURRENT===i.INPUT&&(t=o(e))}),{start:()=>{r.CURRENT=i.MATCH,window.requestAnimationFrame(n)},pause:()=>{r.CURRENT=i.PAUSED}}})().start()}]);","extractedComments":[]}