{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t,n){\"use strict\";var r;n.r(t),function(e){e[e.INPUT=1]=\"INPUT\",e[e.MATCH=2]=\"MATCH\",e[e.DROP=3]=\"DROP\",e[e.DROPPING=4]=\"DROPPING\",e[e.SHUFFLE=5]=\"SHUFFLE\",e[e.SWAPPING=6]=\"SWAPPING\",e[e.PAUSED=7]=\"PAUSED\"}(r||(r={}));const i=[\"red\",\"green\",\"yellow\",\"blue\"],o=(()=>{let e=r.PAUSED;return{get CURRENT(){return e},set CURRENT(t){console.debug(\"OLD STATE: %s \\nNEW STATE: %s\",e,t),e=t}}})(),l=()=>i[4*Math.random()|0],s=(e,t)=>t.reduce((t,n)=>t||n.find(t=>t.index===e),void 0),c=(e,t)=>e.forEach((e,n)=>e.forEach((e,r)=>t(e,n,r))),u=e=>!!e,d=(e,t)=>{let n=s(e.index-8,t)||void 0;return n&&\"empty\"===n.tile.type?d(n,t):n||void 0},a=document.getElementById(\"game\"),m=document.querySelector(\"#tile\"),f=document.querySelector(\"#node\"),p=(e,t,n)=>{const r=n||(Math.abs(e.row-t||0)+1)/8*1;return Object.assign(e,{animationDuration:r})},y=(e,t)=>(e.element.style.transitionDuration=t?`${e.animationDuration}s`:\"0s\",Object.assign(e,{animate:t})),E=(e,t)=>(e.element.dataset.tileType=t,Object.assign(e,{type:t})),T=(e,t,n)=>(t=null!=t?t:e.row,n=null!=n?n:e.column,e.element.style.setProperty(\"--y\",`${50*t+(4.5+4.5*t*2)}px`),e.element.style.setProperty(\"--x\",`${50*n+(4.5+4.5*n*2)}px`),Object.assign(e,{row:t,column:n})),P=(e,t,n)=>(y(e,!1),T(e,t,void 0),p(e,n,void 0),setTimeout(()=>{y(e,!0),T(e,n,void 0),console.debug(`TILE: ${JSON.stringify(e)}`)},0),new Promise(t=>setTimeout(()=>{y(e,!1),t()},1e3*e.animationDuration))),g=e=>(t,n)=>!(!t||!n)&&n.tile.type===e.tile.type,x=(e,t)=>{const n=[];if(e.tile.column+2<8){const r=[e,s(e.index+1,t),s(e.index+2,t)].filter(u);if(3===r.length&&r.reduce(g(e),!0)){const i=s(e.index+3,t),o=s(e.index+4,t);i&&i.tile.row===e.tile.row&&[...r,i].reduce(g(e),!0)&&(r.push(i),o&&o.tile.row===e.tile.row&&[...r,o].reduce(g(e),!0)&&r.push(o)),n.push({nodes:r})}}if(e.tile.row+2<8){const r=[e,s(e.index+8,t),s(e.index+16,t)].filter(u);if(3===r.length&&r.reduce(g(e),!0)){const i=s(e.index+24,t),o=s(e.index+32,t);i&&i.tile.column===e.tile.column&&[...r,i].reduce(g(e),!0)&&(r.push(i),o&&o.tile.column===e.tile.column&&[...r,o].reduce(g(e),!0)&&r.push(o)),n.push({nodes:r})}}return n},N=(e,t,n)=>{const r=((e,t,n=\"empty\")=>{if(!m)throw new Error(\"No tiletemplate found!\");const r=m.content.cloneNode(!0).querySelector(\".tile\");if(!r)throw new Error('Cannot find \".tile\" in tiletemplate');r.dataset.tileType=n,r.innerHTML=\"\",r.style.setProperty(\"--y\",`${50*e+(4.5+4.5*e*2)}px`),r.style.setProperty(\"--x\",`${50*t+(4.5+4.5*t*2)}px`);return{element:r,animationDuration:1*(e+1/8),animate:!1,type:n,row:e,column:t}})(e,t,l());if(!f)throw new Error(\"No nodetemplate found\");const i=f.content.cloneNode(!0).querySelector(\".node\");if(!i)throw new Error('Cannot find \".node\" in nodetemplate');return i.dataset.nodeIndex=n.toString(),i.innerHTML=\"\",{element:i,index:n,tile:r,selected:!1}},R=(e,t)=>{const n=Object.assign({},e.tile);Object.assign(e.tile,t.tile),Object.assign(t.tile,n)},w=e=>{if(e)return Object.assign(e,{selected:!e.selected}),e.element.dataset.nodeSelected=e.selected?\"true\":\"false\",e.selected&&console.debug(`NODE SELECTED: ${JSON.stringify(e)}`),e},b=(e,t)=>{return[e,s(e.index+1,t),s(e.index+2,t),s(e.index-1,t),s(e.index-2,t),s(e.index-8,t),s(e.index-16,t),s(e.index+8,t),s(e.index+16,t)].filter(u)},S=(e,t)=>0===e.tile.column&&7!==t.tile.column||7===e.tile.column&&0!==t.tile.column,h=(e,t)=>{if(!e||!t)return!1;const n=Math.abs(e.index-t.index),r=0===e.tile.column||7===e.tile.column,i=0===t.tile.column||7===t.tile.column,o=S(e,t),l=S(t,e);return!(1!==n&&8!==n||(r||i)&&!o&&!l)},O=(e,t,n)=>!(!t||!h(e,t))&&(console.debug(`SWAP VALID: ${JSON.stringify(e)} <=> ${JSON.stringify(t)}`),R(t,e),!!((e,t,n)=>{return[...b(t,n),...b(e,n)].reduce((e,t)=>[...e,...x(t,n)],[]).length>0})(e,t,n)||(R(t,e),!1)),U=e=>t=>{if(t.target&&t.target.classList.contains(\"node\")){const n=t.target.dataset.nodeIndex;if(n){const t=s(parseInt(n),e);if(t){const n=(e=>e.reduce((e,t)=>e||t.find(e=>e.selected),void 0))(e);O(t,n,e)&&n?(o.CURRENT=r.SWAPPING,((e,t)=>{const n=Object.assign({},e);return p(t,void 0,.5),y(t,!0),p(e,void 0,.5),y(e,!0),T(e,t.row,t.column),T(t,n.row,n.column),new Promise(e=>{setTimeout(()=>{e()},500)})})(n.tile,t.tile).then(()=>{o.CURRENT=r.MATCH}),w(n)):(n&&w(n),w(t))}}}};console.debug=function(){},(()=>{const e=(()=>Array(8).fill(0).map((e,t)=>Array(8).fill(0).map((e,n)=>N(t,n,8*t+n))))(),t=()=>{switch(o.CURRENT){case r.DROP:o.CURRENT=r.DROPPING,(e=>{const t=[...e.map(e=>[...e])],n=[];for(;;){let r=0;if(c(t.reverse(),t=>{if(\"empty\"===t.tile.type){const i=d(t,e),o=t.tile.row;if(i){const e=i.tile.type;E(i.tile,t.tile.type),E(t.tile,e),n.push(P(t.tile,i.tile.row,o))}else E(t.tile,l()),n.push(P(t.tile,t.tile.row-7,o));r++}}),0===r)break}return Promise.all(n)})(e).then(()=>o.CURRENT=r.MATCH);break;case r.MATCH:(e=>{const t=new Set;c(e,n=>{x(n,e).forEach(e=>t.add(e))});const n=t.size>0;return t.forEach(e=>e.nodes.forEach(e=>(e=>{e.type=\"empty\"})(e.tile))),n})(e)?o.CURRENT=r.DROP:(e=>{let t=!0;return c(e,n=>{t&&(t=![s(n.index+1,e),s(n.index+8,e)].map(e=>e&&h(n,e)).some(e=>!!e))}),t})(e)?o.CURRENT=r.SHUFFLE:o.CURRENT=r.INPUT;break;case r.INPUT:}o.CURRENT!==r.PAUSED&&window.requestAnimationFrame(t)};if(!a)throw new Error(\"No gameElement found!\");c(e,e=>{a.appendChild(e.element),a.appendChild(e.tile.element)});const n=U(e);return a.addEventListener(\"click\",e=>{o.CURRENT===r.INPUT&&n(e)}),{start:()=>{o.CURRENT=r.MATCH,window.requestAnimationFrame(t)},pause:()=>{o.CURRENT=r.PAUSED}}})().start()}]);","extractedComments":[]}